<template>
  <div>
<!--    <el-row class="run-test-items">
      <el-col :span="4">请求方法 method：</el-col>
      <el-col :span="14" :offset="1">
        <el-select v-model="data.method" style="width: 100%" @change="changeMethod">
          <el-option label="GET" value="GET"></el-option>
          <el-option label="OPTIONS" value="OPTIONS"></el-option>
          <el-option label="HEAD" value="HEAD"></el-option>
          <el-option label="POST" value="POST"></el-option>
          <el-option label="PUT" value="PUT"></el-option>
          <el-option label="DELETE" value="DELETE"></el-option>
          <el-option label="PROPRFIND" value="PROPRFIND"></el-option>
          <el-option label="TRACE" value="TRACE"></el-option>
          <el-option label="CONNECT" value="CONNECT"></el-option>
          <el-option label="MOVE" value="MOVE"></el-option>
          <el-option label="TRACK" value="TRACK"></el-option>
        </el-select>
      </el-col>
    </el-row>
    <el-row class="run-test-items">
      <el-col :span="4">请求路径 path：</el-col>
      <el-col :span="14" :offset="1">
        <el-input v-model="data.path" @input="changePath"/>
      </el-col>
    </el-row>
    <el-row class="run-test-items">
      <el-col :span="4">请求头 headers：</el-col>
      <el-col :span="14" :offset="1">
        <div v-for="(item, index) in headerList" :key="index" class="header-input-group">
          <InputGroup :value="item" :showDeleteButton="headerList.length > 1" @delete="handleDelete(index)"
                      @change="handleChange(index, $event)" @add="handleAdd"/>
        </div>
        <el-button @click="handleHeaderSubmit" type="primary" plain> 保存请求头</el-button>
        <span style="color: red; margin-left: 10px;"> 注意：填写完请求头后请点击该按钮，否则不会保存请求头！ </span>
      </el-col>
    </el-row>
    <el-row class="run-test-items">
      <el-col :span="4">请求体 body：</el-col>
      <el-col :span="14" :offset="1">
        <el-input type="textarea" :value="data.body" @input="setData(data.id, 'body', $event)" />
      </el-col>
    </el-row>

    <el-row class="run-test-items">
      <el-col :span="4">允许跳转 follow_redirects：</el-col>
      <el-col :span="14" :offset="1">
        <el-switch v-model="data.follow_redirects" @change="setData(data.id, 'follow_redirects', $event)" />
      </el-col>
    </el-row>

    <el-row class="run-test-items">
      <el-col :span="4">提取规则 search：</el-col>
      <el-col :span="14" :offset="1">
        <el-input type="textarea" :value="data.search" @input="setData(data.id, 'search', $event)" />
      </el-col>
    </el-row>

    <el-row class="run-test-items">
      <el-col :span="4">表达式 expression：</el-col>
      <el-col :span="14" :offset="1">
        <el-input type="textarea" :value="data.expression" @input="setData(data.id, 'expression', $event)" />
      </el-col>
    </el-row>-->

  </div>

</template>

<script>
import { message } from 'element-plus';
export default {
  /*props: {
    data: {
      id:'',
      type: Object,
      required: true
    },
    setData: {
      type: Function,
      required: true,
    },
  },*/
  data() {
    return {
      headerList: [{ id: 0, key: "", value: "" }],
    };
  },
  components: {
    InputGroup,
  },
  methods: {
    changeMethod(value) {
      this.$emit("update:data", {...this.data, method: value});
    },
    handleAdd() {
      const keys = this.headerList.map((item) => item.id);
      const maxId = Math.max(0, ...keys) + 1;
      this.headerList.push({ id: maxId, key: "", value: "" });
    },

    handleDelete(index) {
      this.headerList.splice(index, 1);
    },

    handleChange(index, { key, value }) {
      this.headerList[index].key = key;
      this.headerList[index].value = value;
    },

    handleHeaderSubmit() {
      const newVal = {};
      this.headerList.forEach((header) => {
        if (header.key) {
          newVal[header.key] = header.value;
        }
      });
      this.$emit("update:data", { ...this.data, headers: newVal });
      message.success("保存请求头成功");
    },
  }
};
</script>